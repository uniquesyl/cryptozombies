# 改名功能问题解决指南

## 问题描述

用户反馈改名功能失败，提示"改名失败，请重试"。

## 可能的原因

### 1. 僵尸等级不足

- **问题**: 僵尸等级小于 2
- **解决方案**: 需要先将僵尸升级到等级 2 或以上
- **检查方法**: 查看僵尸卡片上的等级显示

### 2. 权限问题

- **问题**: 不是僵尸的所有者
- **解决方案**: 确保当前连接的 MetaMask 账户是僵尸的所有者
- **检查方法**: 确认僵尸卡片显示"只有所有者可以操作此僵尸"

### 3. 网络连接问题

- **问题**: 未连接到正确的网络
- **解决方案**: 确保连接到 Sepolia 测试网
- **检查方法**: MetaMask 网络 ID 应为 11155111

### 4. 余额不足

- **问题**: 账户 ETH 余额不足以支付 gas 费用
- **解决方案**: 确保账户有足够的 ETH
- **检查方法**: 查看 MetaMask 账户余额

### 5. 合约问题

- **问题**: 合约地址错误或合约状态异常
- **解决方案**: 检查合约地址和状态
- **检查方法**: 确认合约地址为 0xB41b741Cf52bDC47111ee0B2D274fCe88Ed758a4

## 诊断步骤

### 步骤 1: 检查基础环境

1. 打开浏览器开发者工具（F12）
2. 切换到 Console 标签页
3. 确保 MetaMask 已安装并连接
4. 确保 ethers.js 已正确加载

### 步骤 2: 检查网络连接

1. 确认 MetaMask 连接到 Sepolia 测试网
2. 检查网络 ID 是否为 11155111
3. 确认账户地址正确

### 步骤 3: 检查僵尸状态

1. 进入"我的僵尸"页面
2. 确认僵尸等级 >= 2
3. 确认您是僵尸的所有者
4. 检查僵尸是否处于正常状态

### 步骤 4: 测试改名功能

1. 选择一个等级 >= 2 的僵尸
2. 点击"显示操作"按钮
3. 在改名输入框中输入新名称
4. 点击"改名"按钮
5. 在 MetaMask 中确认交易

### 步骤 5: 查看错误信息

1. 如果失败，查看浏览器控制台的错误信息
2. 查看 MetaMask 的错误提示
3. 记录具体的错误信息

## 常见错误及解决方案

### 错误 1: "僵尸等级不足，需要等级 >= 2 才能改名"

- **原因**: 僵尸等级小于 2
- **解决**: 先升级僵尸到等级 2 或以上

### 错误 2: "您不是这个僵尸的所有者，无法改名"

- **原因**: 当前账户不是僵尸的所有者
- **解决**: 切换到正确的 MetaMask 账户

### 错误 3: "missing revert data"

- **原因**: 合约调用失败
- **解决**: 检查僵尸状态、网络连接和合约地址

### 错误 4: "insufficient funds"

- **原因**: 账户余额不足
- **解决**: 确保有足够的 ETH 支付 gas 费用

### 错误 5: "user rejected"

- **原因**: 用户在 MetaMask 中取消了交易
- **解决**: 重新尝试并确认交易

## 测试脚本

### 基础测试

```javascript
// 在浏览器控制台中运行
fixRenameIssue();
```

### 详细诊断

```javascript
// 在浏览器控制台中运行
diagnoseRenameIssue();
```

## 预防措施

1. **定期检查网络连接**: 确保始终连接到正确的网络
2. **保持足够余额**: 确保账户有足够的 ETH 支付 gas 费用
3. **及时升级僵尸**: 将僵尸升级到等级 2 以上以解锁改名功能
4. **备份重要信息**: 记录重要的合约地址和账户信息

## 联系支持

如果按照以上步骤仍然无法解决问题，请提供以下信息：

1. 具体的错误信息
2. 浏览器控制台的完整日志
3. MetaMask 的错误提示
4. 僵尸的详细信息（ID、等级、所有者）
5. 网络连接状态

## 更新日志

- 2024-01-XX: 创建问题解决指南
- 2024-01-XX: 添加诊断脚本
- 2024-01-XX: 完善错误处理
